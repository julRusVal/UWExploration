<?xml version="1.0" ?>

<launch>
    <!-- This is based off the ipp.launch file. -->
	
    <!-- If mode = sim: Simulated AUV with MBES and control in loaded bathymetric map 
	If mode = gt: reproduce Hugin survey and construct map of real bathymetry --> 
    <arg name="mode"                            default="sim"/>
    <arg name="namespace"                       default="hugin_0"/>
    <arg name="debug"                           default="0"/>
    <arg name="dataset"                         default="ripples"/>
    <arg name="app"                             default="ipp"/>

    <!-- MBES sensor -->
	<arg name="n_beams_mbes"                    default="100"/>	
	<!-- <arg name="mbes_open_angle" value="2.250" /> -->
    <!-- The auv_environment used a default value of 2.0 for mbes_open_angle. -->
    <arg name="mbes_open_angle"                 value="2.0" /> 
  
    <!-- Coordinates of odom frame wrt the map frame. By default, the AUV start the mission here -->
    <arg name="x"                               default="0.0"/>
    <arg name="y"                               default="0.0"/>
    <arg name="z"                               default="0.0"/>
    <arg name="roll"                            default="0.0"/>
    <arg name="pitch"                           default="0.0"/>
    <arg name="yaw"                             default="0.0"/>

    <arg name="map_frame"                       default="map"/>
    <arg name="odom_frame"                      default="$(arg namespace)/odom"/>
    <arg name="odometry_topic"                  default="/$(arg namespace)/$(arg mode)/odom"/>
    <arg name="mbes_pings_topic"                default="/$(arg namespace)/$(arg mode)/mbes_pings"/>

    <!-- Using a single rbpf svgp particle for svgp mapping in this scenario.
    Asumptions: There is only one handler, for the single particle -->
    <!-- RBPF params  -->
    <arg name="particle_count"                  default="1"/>
    <arg name="num_particle_handlers"           default="1"/>
    <arg name="num_particles_per_handler"       default="1"/> 
    <arg name="survey_finished_top"             default="/$(arg namespace)/finished"/>
    <arg name="svgp_mapper_name"                default="svgp_mapper"/>

    <!-- API for SVGP particles -->
    <arg name="gp_ip_topic"                     default="/$(arg namespace)/gp/inducing_points"/>
    <arg name="gp_mb_server"                    default="/$(arg namespace)/gp/minibatch_server"/>
    <arg name="manipulate_gp_server"            default="/$(arg namespace)/gp/manipulate_server"/>
    <arg name="gp_resample_top"                 default="/$(arg namespace)/gp/resample_top"/>
    <arg name="sample_gp_server"                default="/$(arg namespace)/gp/sample_server"/>

    <arg name="results_path"                    default="/home/sam/auv_ws/src/UWExploration/utils/uw_tests/datasets/asko/svgp"/>

    <!-- SVGP params-->
    <arg name="svgp_num_ind_points"             default="400"/>     
    <arg name="svgp_minibatch_size"             default="1000"/>     
    <arg name="svgp_learning_rate"              default="1e-1"/>     
    <arg name="svgp_rtol"                       default="1e-1"/>     
    <arg name="svgp_n_window"                   default="400"/>     
    <arg name="svgp_auto_stop"                  default="False"/>     
    <arg name="svgp_likelihood_noise_floor"     default="0.5"/>     
    <arg name="svgp_verbose"                    default="True"/>


    <!-- <node type="particles_launcher.py" pkg="rbpf_slam" name="particle_launcher" output="screen">
        <param name="namespace" value="$(arg namespace)"/>  
        <param name="n_beams_mbes" value="$(arg n_beams_mbes)"/>  
        <param name="results_path" value="$(arg results_path)" />
        <param name="num_particle_handlers" value="$(arg num_particle_handlers)"/>     
        <param name="num_particles_per_handler" value="$(eval arg('particle_count') / arg('num_particle_handlers'))"/>     
        <param name="particle_launch_file" value="$(find rbpf_slam)/launch/particle.launch"/>     
    </node> -->

    <!-- Skipping some steps and calling a single particle of rbpf_svgp to serve as map -->

    <node ns="$(arg namespace)" type="rbpf_svgp.py" pkg="rbpf_slam" name="$(arg svgp_mapper_name)" output="screen">
        <param name="namespace" value="$(arg namespace)"/> 
        <param name="minibatch_gp_server" value="$(arg gp_mb_server)"/>     
        <!-- <param name="plot_gp_server" value="$(arg gp_plot_server)"/>      -->
        <param name="manipulate_gp_server" value="$(arg manipulate_gp_server)"/>     
        <param name="sample_gp_server" value="$(arg sample_gp_server)"/>     
        <param name="inducing_points_top" value="$(arg gp_ip_topic)"/>   
        <param name="gp_resampling_top"  value="$(arg gp_resample_top)" />
        <!-- SVGP params -->
        <param name="svgp_num_ind_points" value="400"/>     
        <param name="svgp_minibatch_size" value="1000"/>     
        <param name="svgp_learning_rate" value="1e-1"/>     
        <param name="svgp_rtol" value="1e-1"/>     
        <param name="svgp_n_window" type="int" value="400"/>     
        <param name="svgp_auto_stop" value="False"/>
        <param name="svgp_likelihood_noise_floor" value="$(arg svgp_likelihood_noise_floor)"/> 
        <param name="svgp_verbose" value="True"/>     
        <!-- End SVGP params -->
        <param name="num_particles_per_handler" value="$(arg num_particles_per_handler)"/>     
        <param name="results_path" value="$(arg results_path)"/> 
        <param name="particle_enable_lc" value="/$(arg namespace)/enable_lc"/> 
        <param name="n_beams_mbes"   type= "int"  value="$(arg n_beams_mbes)" />       
    </node>

    <node ns="$(arg namespace)" type="auv_ui_online.py" pkg="uncert_management" name="auv_ui_online" output="screen">
        <param name="namespace" value="$(arg namespace)"/>  
        <param name="map_frame" value="$(arg map_frame)" />
        <param name="odom_frame" value="$(arg odom_frame)" />
        <param name="base_link" value="$(arg namespace)/base_link" />
        <param name="mbes_link" value="$(arg namespace)/mbes_link" />
        <param name="odometry_topic" value="$(arg odometry_topic)" />
        <param name="mbes_pings_topic" value="$(arg mbes_pings_topic)" />
        <param name="background_img_path" value="$(find uw_tests)/datasets/$(arg dataset)/default_real_mean_depth.png" />       
        <param name="dataset" value="$(arg dataset)" />       
        <param name="visualization_period" value="0.5" />       
        <param name="survey_finished_top" value="$(arg survey_finished_top)" />
        <param name="minibatch_gp_server" value="$(arg gp_mb_server)"/>    
        <param name="inducing_points_top" value="$(arg gp_ip_topic)"/>     
        <param name="path_topic"  value="/$(arg namespace)/gp/waypoints" />
        <param name="gp_resampling_top"  value="$(arg gp_resample_top)" />
        <param name="manipulate_gp_server"  value="$(arg manipulate_gp_server)" />
        <param name="synch_topic" value="/$(arg app)/synch" />
    </node>

</launch>

